{
  "$schema": "https://claude.ai/schemas/workflow.json",
  "name": "bug-fix",
  "description": "ç³»ç»ŸåŒ–çš„ Bug ä¿®å¤å·¥ä½œæµ",
  "version": "1.0.0",
  "steps": [
    {
      "id": "reproduce-bug",
      "name": "é‡ç° Bug",
      "type": "analysis",
      "description": "ç†è§£ Bug å¹¶åˆ›å»ºæœ€å°å¤ç°ç”¨ä¾‹",
      "tasks": [
        "ç†è§£ Bug çš„ç°è±¡å’Œå½±å“",
        "åˆ›å»ºæœ€å°åŒ–å¤ç°ç”¨ä¾‹",
        "è®°å½•å½“å‰è¡Œä¸ºå’ŒæœŸæœ›è¡Œä¸º",
        "åˆ†ææ ¹æœ¬åŸå› "
      ],
      "output": {
        "reproduction-steps": "string",
        "expected-behavior": "string",
        "actual-behavior": "string",
        "root-cause": "string"
      }
    },
    {
      "id": "create-bugfix-branch",
      "name": "åˆ›å»º Bug ä¿®å¤åˆ†æ”¯",
      "type": "git",
      "command": "git checkout -b bugfix/${issue-number}-${brief-description}",
      "validation": {
        "type": "branch-exists",
        "pattern": "bugfix/*"
      }
    },
    {
      "id": "write-failing-test",
      "name": "ç¼–å†™å¤±è´¥çš„æµ‹è¯•",
      "type": "testing",
      "agent": "test-expert",
      "description": "å…ˆå†™ä¸€ä¸ªèƒ½é‡ç° Bug çš„æµ‹è¯•ç”¨ä¾‹",
      "validation": {
        "type": "test-fails",
        "expectation": "new-test-should-fail"
      },
      "guidance": [
        "æµ‹è¯•åº”è¯¥æ¸…æ™°å±•ç¤º Bug çš„è¡Œä¸º",
        "è¿è¡Œæµ‹è¯•ï¼Œç¡®ä¿å®ƒå¤±è´¥",
        "å¤±è´¥åŸå› åº”è¯¥ä¸ Bug æè¿°ä¸€è‡´"
      ]
    },
    {
      "id": "fix-implementation",
      "name": "ä¿®å¤å®ç°",
      "type": "development",
      "description": "å®æ–½æœ€å°åŒ–çš„ä¿®å¤",
      "validation": {
        "type": "test-passes",
        "command": "npm run test:run"
      },
      "guidance": ["å®šä½åˆ°é—®é¢˜ä»£ç ", "å®æ–½æœ€å°åŒ–ä¿®å¤", "é¿å…å¼•å…¥æ–°é—®é¢˜", "éµå¾ªç°æœ‰ä»£ç é£æ ¼"]
    },
    {
      "id": "verify-fix",
      "name": "éªŒè¯ä¿®å¤",
      "type": "validation",
      "parallel": true,
      "substeps": [
        {
          "name": "å¤±è´¥çš„æµ‹è¯•ç°åœ¨é€šè¿‡",
          "command": "npm run test -- --run ${test-file}",
          "required": true
        },
        {
          "name": "æ‰€æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡",
          "command": "npm run test:run",
          "required": true
        },
        {
          "name": "æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡",
          "command": "npm run test:coverage",
          "validation": {
            "coverage": 100
          }
        },
        {
          "name": "TypeScript ç±»å‹æ£€æŸ¥",
          "command": "npm run typecheck",
          "required": true
        },
        {
          "name": "ä»£ç æ£€æŸ¥",
          "command": "npm run lint:all",
          "required": true
        }
      ]
    },
    {
      "id": "regression-testing",
      "name": "å›å½’æµ‹è¯•",
      "type": "testing",
      "description": "ç¡®ä¿ä¿®å¤æ²¡æœ‰å¼•å…¥æ–°çš„ Bug",
      "tasks": ["æµ‹è¯•ç›¸å…³åŠŸèƒ½", "æ£€æŸ¥è¾¹ç•Œæƒ…å†µ", "éªŒè¯é”™è¯¯å¤„ç†", "æµ‹è¯•æ€§èƒ½å½±å“"]
    },
    {
      "id": "add-defensive-tests",
      "name": "æ·»åŠ é˜²å¾¡æ€§æµ‹è¯•",
      "type": "testing",
      "agent": "test-expert",
      "description": "ä¸ºç›¸å…³åœºæ™¯æ·»åŠ æ›´å¤šæµ‹è¯•ï¼Œé˜²æ­¢å°†æ¥å†æ¬¡å‡ºç°",
      "guidance": ["è¦†ç›–ç±»ä¼¼çš„è¾¹ç•Œæƒ…å†µ", "æµ‹è¯•ç›¸å…³çš„é”™è¯¯è·¯å¾„", "æ·»åŠ æç«¯å€¼æµ‹è¯•"]
    },
    {
      "id": "update-docs",
      "name": "æ›´æ–°æ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰",
      "type": "documentation",
      "optional": true,
      "agent": "doc-generator",
      "conditions": ["API è¡Œä¸ºå˜æ›´", "æ–°çš„é™åˆ¶æˆ–è¦æ±‚", "ç‰¹æ®Šçš„è¾¹ç•Œæƒ…å†µ"]
    },
    {
      "id": "commit-fix",
      "name": "æäº¤ä¿®å¤",
      "type": "git",
      "substeps": [
        {
          "name": "æŸ¥çœ‹å˜æ›´",
          "command": "git status && git diff"
        },
        {
          "name": "æš‚å­˜å˜æ›´",
          "command": "git add ."
        },
        {
          "name": "æäº¤ä¿®å¤",
          "command": "git commit -m 'fix: ${fix-description}\n\n${detailed-explanation}\n\nFixes #${issue-number}\n\nğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>'",
          "validation": {
            "type": "conventional-commits",
            "requiresIssueNumber": true
          }
        }
      ]
    },
    {
      "id": "create-pr",
      "name": "åˆ›å»º Pull Request",
      "type": "git",
      "optional": true,
      "command": "gh pr create --title 'fix: ${pr-title}' --body '${pr-body}'",
      "prTemplate": {
        "sections": ["Bug Description", "Root Cause", "Solution", "Test Plan", "Related Issue"]
      }
    }
  ],
  "checklist": [
    "âœ… ç†è§£å¹¶èƒ½é‡ç° Bug",
    "âœ… åˆ›å»ºäº† bugfix åˆ†æ”¯",
    "âœ… ç¼–å†™äº†å¤±è´¥çš„æµ‹è¯•",
    "âœ… å®æ–½äº†æœ€å°åŒ–ä¿®å¤",
    "âœ… æµ‹è¯•ç°åœ¨é€šè¿‡",
    "âœ… æ‰€æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡",
    "âœ… æ·»åŠ äº†é˜²å¾¡æ€§æµ‹è¯•",
    "âœ… ç±»å‹æ£€æŸ¥é€šè¿‡",
    "âœ… ä»£ç æ£€æŸ¥é€šè¿‡",
    "âœ… è¦†ç›–ç‡è¾¾æ ‡",
    "âœ… æ›´æ–°äº†æ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰",
    "âœ… æäº¤ä¿¡æ¯è§„èŒƒ",
    "âœ… åˆ›å»ºäº† PRï¼ˆå¦‚éœ€è¦ï¼‰"
  ],
  "hooks": {
    "onStart": [
      {
        "action": "create-session",
        "metadata": {
          "type": "bug-fix",
          "issueNumber": "${issue-number}"
        }
      },
      {
        "action": "load-similar-fixes",
        "fromMemory": "patterns/bug-fixes"
      }
    ],
    "onComplete": [
      {
        "action": "save-bug-pattern",
        "target": "memory/patterns/common-bugs.md"
      },
      {
        "action": "update-metrics",
        "metrics": ["bug-fix-time", "tests-added"]
      }
    ]
  },
  "antiPatterns": [
    "ä¿®å¤ç—‡çŠ¶è€Œéæ ¹æœ¬åŸå› ",
    "åœ¨ä¿®å¤ä¸­æ·»åŠ æ–°åŠŸèƒ½",
    "è·³è¿‡æµ‹è¯•ç›´æ¥ä¿®æ”¹",
    "è¿‡åº¦ä¿®æ”¹æ— å…³ä»£ç "
  ],
  "bestPractices": ["æœ€å°åŒ–ä¿®æ”¹èŒƒå›´", "æµ‹è¯•ä¼˜å…ˆ", "å®Œæ•´çš„å›å½’æµ‹è¯•", "è®°å½•æ ¹æœ¬åŸå› ", "æ›´æ–°ç›¸å…³æ–‡æ¡£"]
}
