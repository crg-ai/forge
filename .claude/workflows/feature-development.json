{
  "$schema": "https://claude.ai/schemas/workflow.json",
  "name": "feature-development",
  "description": "å®Œæ•´çš„åŠŸèƒ½å¼€å‘å·¥ä½œæµ",
  "version": "1.0.0",
  "steps": [
    {
      "id": "create-branch",
      "name": "åˆ›å»ºåŠŸèƒ½åˆ†æ”¯",
      "type": "git",
      "command": "git checkout -b feature/${feature-name}",
      "optional": false,
      "validation": {
        "type": "branch-exists",
        "pattern": "feature/*"
      }
    },
    {
      "id": "write-tests",
      "name": "ç¼–å†™æµ‹è¯•ï¼ˆTDDï¼‰",
      "type": "development",
      "description": "å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æµ‹è¯•å¤±è´¥ï¼ˆRedï¼‰",
      "agent": "test-expert",
      "files": "**/*.test.ts",
      "validation": {
        "type": "test-exists",
        "coverage": 100
      },
      "guidance": [
        "å‚è€ƒ .claude/rules/testing.md",
        "ä½¿ç”¨ AAA æ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰",
        "æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†",
        "ç¡®ä¿æµ‹è¯•å¤±è´¥åå†ç»§ç»­"
      ]
    },
    {
      "id": "implement-feature",
      "name": "å®ç°åŠŸèƒ½",
      "type": "development",
      "description": "éµå¾ª DDD æ¨¡å¼å®ç°åŠŸèƒ½ï¼Œç¡®ä¿æµ‹è¯•é€šè¿‡ï¼ˆGreenï¼‰",
      "agent": "ddd-frontend-expert",
      "validation": {
        "type": "tests-pass",
        "command": "npm run test:run"
      },
      "guidance": [
        "å‚è€ƒ .claude/rules/ddd-patterns.md",
        "éµå¾ª .claude/rules/code-style.md",
        "ä½¿ç”¨ TypeScript æœ€ä½³å®è·µ",
        "ä¿æŒå‡½æ•°ç®€æ´ï¼ˆ< 30 è¡Œï¼‰",
        "ä¿æŒç±»èŒè´£å•ä¸€ï¼ˆ< 200 è¡Œï¼‰"
      ]
    },
    {
      "id": "refactor",
      "name": "é‡æ„ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰",
      "type": "development",
      "description": "ä¼˜åŒ–ä»£ç ç»“æ„å’Œå¯è¯»æ€§ï¼ˆRefactorï¼‰",
      "optional": true,
      "validation": {
        "type": "tests-still-pass",
        "command": "npm run test:run"
      },
      "guidance": ["æ¶ˆé™¤é‡å¤ä»£ç ", "æé«˜å¯è¯»æ€§", "ä¼˜åŒ–æ€§èƒ½ï¼ˆå¦‚éœ€è¦ï¼‰", "ç¡®ä¿æµ‹è¯•ä»ç„¶é€šè¿‡"]
    },
    {
      "id": "run-validations",
      "name": "è¿è¡Œå®Œæ•´éªŒè¯",
      "type": "validation",
      "parallel": true,
      "substeps": [
        {
          "name": "TypeScript ç±»å‹æ£€æŸ¥",
          "command": "npm run typecheck",
          "required": true
        },
        {
          "name": "ä»£ç æ£€æŸ¥",
          "command": "npm run lint:all",
          "required": true
        },
        {
          "name": "è¿è¡Œæµ‹è¯•",
          "command": "npm run test:run",
          "required": true
        },
        {
          "name": "æµ‹è¯•è¦†ç›–ç‡",
          "command": "npm run test:coverage",
          "required": true,
          "validation": {
            "coverage": 100
          }
        },
        {
          "name": "æ„å»ºé¡¹ç›®",
          "command": "npm run build",
          "required": true
        },
        {
          "name": "æ£€æŸ¥åŒ…å¤§å°",
          "command": "npm run size",
          "required": true,
          "validation": {
            "maxSize": "10kb"
          }
        }
      ]
    },
    {
      "id": "code-review",
      "name": "ä»£ç å®¡æŸ¥",
      "type": "review",
      "agent": "code-reviewer",
      "optional": false,
      "checklist": [
        "DDD æ¨¡å¼ä½¿ç”¨æ­£ç¡®",
        "ç±»å‹å®‰å…¨",
        "æµ‹è¯•å®Œæ•´",
        "ä»£ç å¯è¯»æ€§é«˜",
        "æ€§èƒ½è€ƒè™‘",
        "æ–‡æ¡£å®Œæ•´"
      ]
    },
    {
      "id": "commit-changes",
      "name": "æäº¤ä»£ç ",
      "type": "git",
      "substeps": [
        {
          "name": "æŸ¥çœ‹å˜æ›´",
          "command": "git status && git diff",
          "interactive": true
        },
        {
          "name": "æš‚å­˜å˜æ›´",
          "command": "git add .",
          "validation": {
            "type": "has-changes"
          }
        },
        {
          "name": "è§„èŒƒåŒ–æäº¤",
          "command": "npm run commit",
          "alternative": "git commit -m 'feat: ${commit-message}\n\n${detailed-description}\n\nğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>'",
          "validation": {
            "type": "conventional-commits"
          }
        }
      ]
    },
    {
      "id": "create-pr",
      "name": "åˆ›å»º Pull Request",
      "type": "git",
      "optional": true,
      "substeps": [
        {
          "name": "æ¨é€åˆ°è¿œç¨‹",
          "command": "git push -u origin feature/${feature-name}"
        },
        {
          "name": "åˆ›å»º PR",
          "command": "gh pr create --title 'feat: ${pr-title}' --body '${pr-body}'",
          "template": ".github/pull_request_template.md"
        }
      ]
    },
    {
      "id": "save-to-memory",
      "name": "ä¿å­˜åˆ°è®°å¿†ç³»ç»Ÿ",
      "type": "internal",
      "action": "save-patterns",
      "targets": ["short-term", "patterns"],
      "data": {
        "type": "feature-development",
        "patterns": "extracted-from-session",
        "decisions": "architectural-choices",
        "learnings": "what-worked-well"
      }
    }
  ],
  "hooks": {
    "onStart": [
      {
        "action": "create-session",
        "saveContext": true
      },
      {
        "action": "check-branch",
        "ensureClean": true
      }
    ],
    "onStepComplete": [
      {
        "action": "update-todo-list",
        "markCompleted": true
      },
      {
        "action": "save-progress",
        "target": "session"
      }
    ],
    "onComplete": [
      {
        "action": "generate-summary",
        "includeMetrics": true
      },
      {
        "action": "save-to-memory",
        "categories": ["patterns", "best-practices"]
      },
      {
        "action": "close-session",
        "archive": true
      }
    ],
    "onError": [
      {
        "action": "save-error-context",
        "target": "memory/short-term"
      },
      {
        "action": "suggest-solutions",
        "fromMemory": true
      }
    ]
  },
  "agents": {
    "primary": "ddd-frontend-expert",
    "supporting": ["test-expert", "code-reviewer"]
  },
  "metrics": {
    "track": ["duration", "steps-completed", "tests-written", "coverage-achieved", "lines-changed"]
  },
  "notifications": {
    "onComplete": {
      "type": "success",
      "message": "åŠŸèƒ½å¼€å‘å®Œæˆï¼âœ¨"
    },
    "onError": {
      "type": "error",
      "message": "å·¥ä½œæµé‡åˆ°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¯¦æƒ…"
    }
  }
}
